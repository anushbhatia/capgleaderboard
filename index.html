<html>   
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1"> 
        <script type="text/javascript" src="https://code.jquery.com/jquery-1.9.1.js"></script>
        <link rel="stylesheet" href="./css/leaderboard.css">
        <link rel="stylesheet" href="./css/bootstrap_3.minf561.css">
    </head>
    <body onload="init();" id="main-body">
        <div class="outer-div">
            <p id="output"></p>
            <div class="showDiv" id="userLeaderboard">
                <div class="large-text">
                    <p>Happiest face</p>
                </div>
               
                <div id="photos" >
    
                    <!-- @*put photos here*@ -->
                    <table class="photo-table">
                        <tr>
                            <td>
                                <div class="photo-div2" id="photo2">
                                    <img src="./images/face.jpg" id="image2" alt="Smile 1" width="320" height="180">
                                    <table class="result-table">
                                        <col width="50%">
                                        <col width="50%">
                                        <tr class="result-score-line">
                                            <td class="photo-result-tab-left">
                                                <p id="userNameText2" class="result-name-text"></p>
                                            </td>
                                            <td>
                                                <div class="result-score-div">
                                                    <p id="scoreText2" class="result-score-text"></p>
                                                </div>
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                            </td>
                            <td>
                                <div class="photo-div1" id="photo1">
                                    <img src="" id="image1" alt="Smile 2" width="320" height="180">
                                    <table class="result-table">
                                        <col width="50%">
                                        <col width="50%">
                                        <tr class="result-score-line">
                                            <td class="photo-result-tab-left">
                                                <p id="userNameText1" class="result-name-text"></p>
                                            </td>
                                            <td>
                                                <div class="result-score-div">
                                                    <p id="scoreText1" class="result-score-text"></p>
                                                </div>
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                            </td>
                            <td>
                                <div class="photo-div3" id="photo3">
                                    <img src="" id="image3" alt="Smile 3" width="320" height="180">
                                    <table class="result-table">
                                        <col width="50%">
                                        <col width="50%">
                                        <tr class="result-score-line">
                                            <td class="photo-result-tab-left">
                                                <p id="userNameText3" class="result-name-text"></p>
                                            </td>
                                            <td>
                                                <div class="result-score-div">
                                                    <p id="scoreText3" class="result-score-text"></p>
                                                </div>
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                            </td>
                        </tr>
                    </table>
                </div>
    
                <div class="center-div" id="user-screen">
    
                    <table id="leaderBoardScores" >
                        <tbody class="table-background"></tbody>
                    </table>
                </div>
                <div class="tabs3">
                    <div class="form">

                        <ul class="tab-group">
                            <li class="tab active"><a href="#leaderboard">Leading Partner</a></li>
                            <li class="tab"><a href="#top5">Top 5 Scores</a></li>
                        </ul>
            
                        <div class="tab-content">
                            <div id="leaderboard">
                                <table class="table3">
                                    <thead>
                                      <tr>
                                    <th>Sr. No.</th>
                                    <th class="name">Name</th>
                                    <th class="score">Points</th>
                                    </tr>
                                    </thead>
                                <tbody id="leaderboardcontent">
                                
                                <!-- <tr class="">
                                
                                    <td class="rank"><p><span class="number">1</span></p></td>
                                
                                    <td class="name"><p><a href="#" target="_blank">
                                            <span class="first-letter color1">B</span>
                                        </a>Anush Bhatia</p>
                                    </td>
                                    
                                    <td><p><span class="mark">566025</span> Points</p></td>
                                    
                                    
                                </tr>
                                
                                
                                <tr class="">
                                
                                    <td class="rank"><p><span class="number">2</span></p></td>
                                
                                    <td class="name"><p><a href="#" target="_blank">
                                            <span class="first-letter color2">R</span>
                                        </a>Rajesh Agrawal</p>
                                    </td>
                                    
                                    <td><p><span class="mark">549425</span> Points</p></td>
                                    
                                    
                                    
                                </tr>
                                
                                
                                <tr class="">
                                
                                    <td class="rank"><p><span class="number">3</span></p></td>
                                
                                    <td class="name"><p><a href="#" target="_blank">
                                            <span class="first-letter color3">S</span>
                                        </a>Sakshi Sharma</p>
                                    </td>
                                    
                                    <td><p><span class="mark">436775</span> Points</p></td>
                                    
                                    
                                    
                                </tr>
                                
                                
                                <tr class="">
                                
                                    <td class="rank"><p><span class="number">4</span></p></td>
                                
                                    <td class="name"><p><a href="#" target="_blank">
                                            <span class="first-letter color4">J</span>
                                        </a>Jaideep Sagar</p>
                                    </td>
                                    
                                    <td><p><span class="mark">436325</span> Points</p></td>
                                    
                                    
                                    
                                </tr>
                                
                                
                                <tr class="">
                                
                                    <td class="rank"><p><span class="number">5</span></p></td>
                                
                                    <td class="name"><p><a href="#" target="_blank">
                                            <span class="first-letter color5">N</span>
                                        </a>Nikhlesh Sharma</p>
                                    </td>
                                    
                                    <td><p><span class="mark">435750</span> Points</p></td>
                                    
                                    
                                    
                                </tr>
                                
                                
                                <tr class="">
                                
                                    <td class="rank"><p><span class="number">6</span></p></td>
                                
                                    <td class="name"><p><a href="#" target="_blank">
                                            <span class="first-letter color6">P</span>
                                        </a>Prasanth S</p>
                                    </td>
                                    
                                    <td><p><span class="mark">430150</span> Points</p></td>
                                    
                                    
                                    
                                </tr>
                                
                                
                                <tr class="">
                                
                                    <td class="rank"><p><span class="number">7</span></p></td>
                                
                                    <td class="name"><p><a href="#" target="_blank">
                                            <span class="first-letter color7">A</span>
                                        </a>Arsh Goyal</p>
                                    </td>
                                    
                                    <td><p><span class="mark">213475</span> Points</p></td>
                                    
                                    
                                    
                                </tr>
                                
                                
                                <tr class="">
                                
                                    <td class="rank"><p><span class="number">8</span></p></td>
                                
                                    <td class="name"><p><a href="#" target="_blank">
                                            <span class="first-letter color8">N</span>
                                        </a>Najeeb Khan</p>
                                    </td>
                                    
                                    <td><p><span class="mark">189275</span> Points</p></td>
                                    
                                    
                                    
                                </tr>
                                
                                
                                <tr class="">
                                
                                    <td class="rank"><p><span class="number">9</span></p></td>
                                
                                    <td class="name"><p><a href="#" target="_blank">
                                            <span class="first-letter color9">M</span>
                                        </a>Mohit Varshney</p>
                                    </td>
                                    
                                    <td><p><span class="mark">163550</span> Points</p></td>
                                    
                                    
                                    
                                </tr>
                                
                                
                                <tr class="">
                                
                                    <td class="rank"><p><span class="number">10</span></p></td>
                                
                                    <td class="name"><p><a href="#" target="_blank">
                                            <img src="./images/face.jpg" alt="name" class="user-pic">
                                        </a>Sachin Dhamal</p>
                                    </td>
                                    
                                    <td><p><span class="mark">131650</span> Points</p></td>
                                    
                                    
                                    
                                </tr>
                                 -->
                        
                                 <div id="myData"></div>
                                </tbody>
                                </table>
                            </div>
            
                            <div id="top5">
                                   <h1 style="color:white">
                                        Leaderboard1
                                    </h1>
                            </div>
            
                        </div><!-- tab-content -->
            
                    </div> 
            </div>
            <div id="companyLeaderboard" class="none">
                <div class="large-text">
                    <p>Leading partner</p>
                </div>
                <div class="center-div" id="company-screen">
                    <div class="company-screen">
                        <table id="companyLeaderBoardScores">
                            <tbody class="table-background"></tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div id="userPhoto" class="none">
                <table>
                    <col width="50%">
                    <col width="50%">
                    <tr>
                        <td>
                            <div>
                                <div class="photo-div">
                                    <img src="" id="userImage" alt="Smile 2" width="400" height="225">
                                    <table class="result-table">
                                        <col width="50%">
                                        <col width="50%">
                                        <tr class="result-score-line">
                                            <td class="photo-result-tab-left">
                                                <p id="userNameText" class="result-name-text"></p>
                                            </td>
                                            <td>
                                                <div class="result-score-div">
                                                    <p id="scoreText" class="result-score-text"></p>
                                                </div>
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div class="result-overview">
                                <p class="info-score-text" id="info-score-text"></p>
                                
                            </div>
                        </td>
    
                    </tr>
                </table>
                
                <p class="top-score-text">Top 5 scores</p>
    
                <table id="leaderBoardScoresUser" style="display: none">
                    <tbody class=""></tbody>
                </table>
                <p class="none">
                    How does it work?
                </p>
                <p class="none">
                    However, we also want you to have fun.
                    <br /><br />
                    A technology that can understand the intricacies of the human face is directly transferable to advanced machine detection in various situations, for both oil and gas plants and in the new green energy sector. It can be applied to predictive load analysis, metal fatigue and a variety of other areas.
                    <br /><br />
                    Try it yourself and ask our experts how you can benefit from new technologies!
                </p>
            </div>
            <div id="info-text" class="showDiv">
            <p class="bottom-info-heading">
                Capgemini Artificial Intelligent Photo Booth 
            </p>
                <p class="bottom-info">
                    This photo booth generates a digital twin of your smiling face, comparing it to hundreds of thousands of other people's faces by employing an advanced analytical data model and analyzing a variety of facial parameters
                    using artificial intelligence. This cognitive algorithm calculates a smile index and tells how happy you are.
                    <br /><br />
                    A technology that can understand the intricacies of the human face is directly transferable to advanced machine detection in various situations, for both oil and gas plants and in the new green energy sector. It can be applied to predictive load analysis, metal fatigue and a variety of other areas.
                    <br /><br />
                    Try it yourseewrwlf and ask our experts how you can benefit from new technologies!
                </p>
            </div>
        </div>
        
    </body>
    <script>
        var scoreObjects = [];
        var companyScoreObjects = [];
        var tempScoreObjects = [];
        var showingUserLeaderboard = true;
        var showingUserPhoto = false;
        var checkingIfNewUserPhoto = false;
        var userLeaderboardActive = true;
        var userRank = 0;
        var initialLoad = true;
        var lastUsername = "Unknown";
        function init() {
            // Get the canvas and obtain a context for
            getLeaderBoard();
            //window.setInterval(function () {
            //    checkForNewUserPhoto();
            //}, 10000);
            window.setInterval(function() {
                checkLeaderBoard();
            }, 12000);
    
    
            //If you need to add company leaderbards add the three lines below
    
            //window.setInterval(function () {
            //    switchBoard();
            //}, 15000);
    
    
           // document.getElementById('main-body').background = url(/images/background - photo - leaderboard.png);
            //$('body').css('background', 'url(../images/leading-partners.png)')
            //$("#companyLeaderboard").removeClass("showDiv");
            $("#main-body").addClass("main-body-people");
        }
        function getLeaderBoard() {
    
            console.log("start fetch single user");
    
            fetch('/api/Photo/leaderboard',{
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json', 
                    }
                })
                .then(response => response.json())
                .then(dataIn => {
                    console.log("Saved data");
                    scoreObjects = dataIn.content;
                    console.log(scoreObjects);
                    var count = 0;
                    $tbody = $("#leaderBoardScores").find('tbody');
    
                    for (var i = 3; i < scoreObjects.length; i++) {
                        if (i % 2 == 0) {
                            var $row = $('<tr class="odd-row">');
                        } else {
                            var $row = $('<tr class="pair-row">');
                        }
                        
                        var $col1 = $('<td class="number-text">');
                        $col1.text((i+1)+".");
                        $row.append($col1);
                        var $col2 = $('<td class="name-text">');
                        $col2.text(scoreObjects[i].name);
                        $row.append($col2);
                        var $col4 = $('<td class="company-text">');
                        $col4.text(scoreObjects[i].company);
                        $row.append($col4);
                        var $col3 = $('<td class="score-text">');
                        $col3.text(scoreObjects[i].score);
                        $row.append($col3);
                        $tbody.append($row);
                        count++;
                    }
                    createPhotos();
                    console.log(count);
                    leaderBoardScores.style.display = "block";
                });
            
        }
    
        function getCompanyLeaderBoard() {
    
            console.log("start fetch");
    
            fetch('/api/Photo/companyLeaderboard', {
                method: 'GET',
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json',
                }
            })
                .then(response => response.json())
                .then(dataIn => {
                    console.log("Saved data");
                    companyScoreObjects = dataIn.content;
                    console.log(companyScoreObjects);
                    var count = 0;
                    $tbody = $("#companyLeaderBoardScores").find('tbody');
    
                    for (var i = 0; i < companyScoreObjects.length; i++) {
                        if (i % 2 == 0) {
                            var $row = $('<tr class="odd-row">');
                        } else {
                            var $row = $('<tr class="pair-row">');
                        }
    
                        var $col1 = $('<td class="number-text">');
                        $col1.text((i + 1) + ".");
                        $row.append($col1);
                        var $col2 = $('<td class="name-text">');
                        $col2.text(companyScoreObjects[i].name);
                        $row.append($col2);
                        var $col3 = $('<td class="score-text">');
                        $col3.text(companyScoreObjects[i].average);
                        $row.append($col3);
                        $tbody.append($row);
                        count++;
                    }
                    console.log(count);
                    companyLeaderBoardScores.style.display = "block";
                });
    
        }
    
        function showCompanyLeaderboard() {
            if (initialLoad) {
                getCompanyLeaderBoard();
                initialLoad = false;
            }
            $("#main-body").addClass("main-body-company");
            $("#main-body").removeClass("main-body-people");
            $("#userLeaderboard").removeClass("showDiv");
            $("#userLeaderboard").addClass("none");
            $("#companyLeaderboard").removeClass("none");
            $("#companyLeaderboard").addClass("showDiv");
            userLeaderboardActive = false;
        }
        function showUserLeaderboard() {
            $("#main-body").addClass("main-body-people");
            $("#main-body").removeClass("main-body-company");
            $("#companyLeaderboard").removeClass("showDiv");
            $("#companyLeaderboard").addClass("none");
            $("#userLeaderboard").removeClass("none");
            $("#userLeaderboard").addClass("showDiv");
            userLeaderboardActive = true;
        }
        function showUserPhoto() {
            if (userLeaderboardActive) {
                $("#userLeaderboard").removeClass("showDiv");
                $("#userLeaderboard").addClass("none");
                $("#main-body").removeClass("main-body-people");
            } else {
                $("#companyLeaderboard").removeClass("showDiv");
                $("#companyLeaderboard").addClass("none");
                $("#main-body").removeClass("main-body-company");
            }
            $("#info-text").removeClass("showDiv");
            $("#info-text").addClass("none");
            
            $("#userPhoto").removeClass("none");
            $("#userPhoto").addClass("showDiv");
        }
    
        function switchBoard() {
            if (!checkingIfNewUserPhoto && !showingUserPhoto) {
                console.log("switching board");
                if (showingUserLeaderboard) {
                    showingUserLeaderboard = false;
                    showCompanyLeaderboard();
                } else {
                    showingUserLeaderboard = true;
                    showUserLeaderboard();
                }
            }
            
        }
    
        function checkForNewUserPhoto() {
            checkingIfNewUserPhoto = true;
            console.log("check for new userPhotos");
            
            fetch('/api/Photo/checkForNewRating', {
                        method: 'GET',
                        headers: {
                            'Accept': 'application/json',
                            'Content-Type': 'application/json',
                        }
                    })
                    .then(response => response.json())
                    .then(dataIn => {
                    var userData = dataIn.content;
                        if (dataIn.content != null && userData.rank > 0) {
                            showingUserPhoto = true;
    
                            console.log(userData);
                            console.log(userData.rank);
                            console.log(userData.score);
                            var userScore = parseFloat(userData.score);
                            userRank = parseFloat(userData.rank);
    
                            if (userScore > -1000) {
                                document.getElementById('scoreText').innerHTML = userScore;
                            } else {
                                document.getElementById('scoreText').innerHTML = 0;
                            }
                            document.getElementById('userNameText').innerHTML = userData.name;
                            lastUsername = userData.name;
                            document.getElementById('userImage').src = userData.url;
                            getLeaderBoardForUserPhoto();
                            showUserPhoto();
                            window.setInterval(function () {
                                location.reload();
                            }, 10000);
                        } 
                        else {
                            console.log("no new user photos");
                            
                        }
                    
                    });
            checkingIfNewUserPhoto = false;
        }
    
        function getLeaderBoardForUserPhoto() {
    
            console.log("start fetch");
    
            fetch('/api/Photo/leaderboard', {
                method: 'GET',
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json',
                }
            })
                .then(response => response.json())
                .then(dataIn => {
                    console.log("Saved data");
                    var scoreObjects = dataIn.content;
                    console.log(scoreObjects);
                    console.log(scoreObjects.score);
                    var count = 0;
                    var $tbody = $("#leaderBoardScoresUser").find('tbody');
                    evaluateScore();
                    if (scoreObjects.length > 5) {
                        for (var i = 0; i < 5; i++) {
                            var $row = $('<tr>');
                            if (userRank == (i + 1) && userRank > 0) {
                                $row = $('<tr class="user-score-in-leaderboard">');
                            }
                            else {
                                $row = $('<tr>');
                            }
                            var $col1 = $('<td class="name-text">');
                            $col1.text(scoreObjects[i].name);
                            $row.append($col1);
                            $col2 = $('<td class="score-text">');
                            $col2.text(scoreObjects[i].score);
                            $row.append($col2);
                            $tbody.append($row);
                            count++;
                        }
                    } else {
                        for (var i = 0; i < scoreObjects.length; i++) {
                            var $row = $('<tr>');
                            if (userRank == (i + 1) && userRank > 0) {
                                $row = $('<tr class="user-score-in-leaderboard">');
                            }
                            else {
                                $row = $('<tr>');
                            }
                            var $col1 = $('<td class="name-text">');
                            $col1.text(scoreObjects[i].name);
                            $row.append($col1);
                            $col2 = $('<td class="score-text">');
                            $col2.text(scoreObjects[i].score);
                            $row.append($col2);
                            $tbody.append($row);
                            count++;
                        }
                    }
                    console.log(count);
                    leaderBoardScoresUser.style.display = "block";
                });
    
        }
    
        function evaluateScore() {
            if (userRank > 3) {
                document.getElementById("info-score-text").textContent =
                    "You are the " + userRank + "th happiest person at RPA-dagen";
            }
            else if (userRank == 3) {
                document.getElementById("info-score-text").textContent = "" + lastUsername +" is the third happiest person at RPA-dagen";
            }
            else if (userRank == 2) {
                document.getElementById("info-score-text").textContent = "" + lastUsername +" is the second happiest person at RPA-dagen";
            }
            else if (userRank == 1) {
                document.getElementById("info-score-text").textContent = "" + lastUsername +" is the happiest person at RPA-dagen";
            }
            else {
                document.getElementById("info-score-text").textContent = "Something went wrong when calculating " + lastUsername +"'s score";
            }
        }
    
        function checkLeaderBoard() {
    
            if (!checkingIfNewUserPhoto && !showingUserPhoto) {
            console.log("start refresh fetch");
    
            fetch('/api/Photo/leaderboard', {
                method: 'GET',
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json',
                }
            })
                .then(response => response.json())
                .then(dataIn => {
                    tempScoreObjects = dataIn.content;
    
                    if (scoreObjects.length !== tempScoreObjects.length) {
                        console.log("new length");
                        location.reload();
                    }
                    else {
                        for (var i = 0; i < tempScoreObjects.length; i++) {
                            if (scoreObjects[i].score !== tempScoreObjects[i].score) {
                                console.log("new score");
                                location.reload();
                            }
                        }
                    }
                });
            }
        }
        function createPhotos() {
            if (scoreObjects.length > 0) {
                document.getElementById('scoreText1').innerHTML = scoreObjects[0].score;
                document.getElementById('userNameText1').innerHTML = scoreObjects[0].name;
                document.getElementById('image1').src = scoreObjects[0].imageUrl;
                $("#photos").removeClass("none");
                $("#photos").addClass("photos-container");
            }
            else {
                $("#photo1").removeClass("photo-div1");
                $("#photo1").addClass("none");
            }
    
            if (scoreObjects.length > 1) {
                document.getElementById('scoreText2').innerHTML = scoreObjects[1].score;
                document.getElementById('userNameText2').innerHTML = scoreObjects[1].name;
                document.getElementById('image2').src = scoreObjects[1].imageUrl;
            }
            else {
                $("#photo2").removeClass("photo-div2");
                $("#photo2").addClass("none");
            }
    
            if (scoreObjects.length > 2) {
                document.getElementById('scoreText3').innerHTML = scoreObjects[2].score;
                document.getElementById('userNameText3').innerHTML = scoreObjects[2].name;
                document.getElementById('image3').src = scoreObjects[2].imageUrl;
            } else {
                $("#photo3").removeClass("photo-div3");
                $("#photo3").addClass("none");
            }
        }
        $(document).ready(function () {
                $('.tab a').on('click', function (e) {
                    e.preventDefault();
                    var _this = $(this);
                    var block = _this.attr('href');
                    $(".tab").removeClass("active");
                    _this.parent().addClass("active");
                    if (block == "#leaderboard") {
                       $(block).fadeIn();
                        $('#top5').hide();
                    }
                    if (block == "#top5") {
                        $(block).fadeIn();
                        $('#leaderboard').hide(); 
                    }
                });
            });
function rankCalculate(list){
    return Object.entries(list).sort((a,b) => b[1].points-a[1].points).map(e1=>e1[1])
}
fetch('data.json')
  .then(function (response) {
    return response.json();
  })
  .then(function (data){
    appendData(rankCalculate(data));
    console.log(rankCalculate(data));
  })
  .catch(function (err) {
    console.log(err);
  });
  function appendData(data) {
  var mainContainer = document.querySelector("#leaderboardcontent");
  for (var i = 0; i < data.length; i++) {
    var div = document.createElement("tr");
    div.innerHTML = ` <td class="rank"><p><span class="number">${i+1}</span></p></td>
    <td class="name"><p><span class="first-letter color${i+1}">${data[i].name[0]}</span>${data[i].name}</p></td> 
    <td>${data[i].points}</td>`;
    mainContainer.appendChild(div);
  }
}
    </script>
</html>